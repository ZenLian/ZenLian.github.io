---
date: 2019-03-12 21:26:00
title: 《TCP-IP详解卷1》学习笔记(8)-Traceroute程序
permalink: tcp-ip-volumn1-8
categories:
- 计算机
- 《TCP-IP详解卷1》
tags:
- 网络
- 读书笔记

---

Traceroute程序用于跟踪路由。

<!--more-->

# 原理

## TTL字段

每经过一个路由器，TTL字段-1。TTL字段为0时，丢弃该数据报，并向源端发送一份超时ICMP报文。

## 操作过程

向目标主机发送TTL为1的IP数据报，第一个路由器收到该数据报将TTL减1，丢弃该数据报，并回发一份超时ICMP报文。Traceroute程序收到该ICMP报文得到第一个路由器的地址。

再向目标主机发送TTL为2的IP数据报，得到第二个路由器的地址，以此类推。

## 如何判断是否到达目标主机

目标主机收到TTL=1的数据报时，该数据报已经到达目的地，所以目标主机不会发送超时ICMP报文。

判断方法是，将数据报的（UDP）目的端口设为一个不可能的值（大于30000），当数据报到达时，目标主机将回发一份“端口不可达”的ICMP报文。

这样就可以通过区分接收到的ICMP报文是“超时”还是“端口不可达”来判断到达路由器还是目标主机，从而判断什么时候结束。



注意：

- 返回的ICMP报文中的源IP地址是路由器的入口地址。



------

# References

1. 《TCP/IP详解卷1：协议》

<!--直来直往-孙燕姿-->
{% meting "003pfwj30rt2iT" "tencent" "song" "autoplay" "fixed" "volume: 0.3" "lrctype:0" %}

