---
title: "lwip 源码阅读笔记 (10) 移植"
date: 2019-07-22T22:18:04+08:00
slug: "lwip-porting"
tags: ["网络", "lwip"]
draft: true
---

lwip 的移植主要由三部分构成：

1. 体系结构移植
2. 操作系统接口移植
3. 网卡驱动移植

## arch 体系结构移植

1. 基本类型定义。根据硬件体系结构定义 lwip 中使用的 `u8_t`、`s8_t` 等基本类型。
2. 其他宏定义。比如 `PACK_STRUCT_STRUCT` 被定义为 `__attribute__((packed))` 等。

## sys 操作系统移植

lwip 要求操作系统提供的接口在 `include/lwip/sys.h` 声明，需要根据特定的操作系统在 `sys_arch.c` 中实现，主要包括：

1. 信号量 `sys_sem_t`。用于线程间同步。
2. 互斥锁 `sys_mutex_t`。可以用二值信号量代替。
3. 邮箱 `sys_mbox_t`。用于线程间通信。
4. 其他接口，包括线程创建、睡眠等。

这些接口在嵌入式 rtos 中基本都有相应的实现，只需要封装成 lwip 需要的接口形式。lwip 代码中会使用这些系统接口来实现它的功能，但 lwip 本身并不关心这些接口是如何实现的。

## 网卡驱动移植

`netif/ethernetif.c` 提供了一个以太网网卡驱动的框架，可以参照该框架编写相应的网卡驱动，主要需要实现一个 netif 结构。
